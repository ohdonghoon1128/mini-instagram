(function(){angular.module("instagramApp",["ngRoute","ngSanitize","ui.bootstrap"]);function t(t){t.when("/",{templateUrl:"/app_client/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/setting/profile",{templateUrl:"/app_client/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/setting/account",{templateUrl:"/app_client/account/account.view.html",controller:"accountCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("instagramApp").config(["$routeProvider",t])})();(function(){angular.module("instagramApp").controller("homeCtrl",t);t.$inject=["$http"];function t(t){const e=this;e.pageHeader={title:"mini-instagram"};e.data={photos:["test/pic-1.jpg","test/pic-2.jpg","test/pic-3.jpg","test/pic-4.jpg","test/pic-5.jpg","test/pic-6.jpg","test/pic-7.jpg"]}}})();(function(){angular.module("instagramApp").controller("profileCtrl",t);t.$inject=["authentication"];function t(t){const e=this;e.pageHeader={title:"Profile"};e.formData={};e.onSubmit=function(){e.formError="";e.formSuccess="";if(!e.formData.name&&!e.formData.email){}else{}return false}}})();(function(){angular.module("instagramApp").controller("accountCtrl",t);t.$inject=["authentication","$location"];function t(t,e){const n=this;n.pageHeader={title:"Account"};n.formData={};n.onSubmit=function(){n.formError="";n.formSuccess="";if(!n.formData.password||!n.formData.newPassword||!n.formData.confirmNewPassword){n.formError="old password, new password and confirm new password are required"}else if(n.formData.newPassword!==n.formData.confirmNewPassword){n.formError="new password and confirm new password must be the same"}else{t.changePassword(n.formData).then(t=>{n.formSuccess="Password successfully changed"}).then(null,t=>{n.formError=t.data.message})}return false};n.deleteAccount=function(){t.deleteAccount().then(t=>{e.path("/")}).then(null,t=>{n.formError=t.data.message})}}})();(function(){angular.module("instagramApp").controller("loginModalCtrl",t);t.$inject=["$uibModalInstance","authentication"];function t(t,e){const n=this;n.formData={};n.onSubmit=function(){n.formError="";if(!n.formData.userid||!n.formData.password){n.formError="userid and password are required!";return false}else{e.login(n.formData).then(e=>{t.close()}).then(null,t=>{n.formError=t.data.message});return false}};n.cancel=function(){t.dismiss("cancel")}}})();(function(){angular.module("instagramApp").controller("registerModalCtrl",t);t.$inject=["$uibModalInstance","authentication"];function t(t,e){const n=this;n.formData={};n.onSubmit=function(){n.formError="";if(!n.formData.userid||!n.formData.email||!n.formData.password){n.formError="userid, email and password are required!"}else if(n.formData.password!==n.confirmPassword){n.formError="Your password does not match each other."}else{e.register(n.formData).then(e=>{t.close()}).then(null,t=>{n.formError=t.data.message})}return false};n.cancel=function(){t.dismiss("cancel")}}})();(function(){angular.module("instagramApp").directive("pageHeader",t);function t(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/app_client/common/directives/pageHeader.template.html"}}})();(function(){angular.module("instagramApp").directive("navigation",t);function t(){return{restrict:"EA",templateUrl:"/app_client/common/directives/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("instagramApp").controller("navigationCtrl",t);t.$inject=["authentication","$location","$uibModal","$window"];function t(t,e,n,r){const o=this;o.isLoggedIn=t.isLoggedIn();o.currentPath=e.path();o.currentUser=t.currentUser();o.logout=function(){t.logout();r.location.assign("/");r.reload()};o.login=function(){const t=n.open({templateUrl:"/app_client/loginModal/loginModal.view.html",controller:"loginModalCtrl as vm"});t.result.then(t=>{r.location.assign(o.currentPath);r.reload()})};o.register=function(){const t=n.open({templateUrl:"/app_client/registerModal/registerModal.view.html",controller:"registerModalCtrl as vm"});t.result.then(t=>{r.location.assign(o.currentPath);r.reload()})}}})();(function(){angular.module("instagramApp").directive("footerGeneric",t);function t(){return{restrict:"EA",templateUrl:"/app_client/common/directives/footerGeneric.template.html"}}})();(function(){angular.module("instagramApp").directive("settingPanel",t);function t(){return{restrict:"EA",scope:{select:"=select"},templateUrl:"/app_client/common/directives/settingPanel.template.html"}}})();(function(){angular.module("instagramApp").service("authentication",t);t.$inject=["$http","$window"];function t(t,e){const n=function(){return e.localStorage.userToken};const r=function(t){if(!t){throw new Error(`invalid token(${t})`)}e.localStorage.userToken=t};const o=function(e){return t.post(`/api/account/register`,e).then(t=>{r(t.data.token);return t})};const a=function(e){return t.post(`/api/account/login`,e).then(t=>{r(t.data.token);return t})};const i=function(t){};const c=function(e){return t.put(`/api/account/password`,e,{headers:{Authorization:"Bearer "+n()}}).then(t=>{r(t.data.token);return t})};const l=function(){return t.delete(`/api/account/delete`,{headers:{Authorization:"Bearer "+n()}})};const s=function(){e.localStorage.removeItem("userToken")};const u=function(){const t=n();if(!t){return false}const r=JSON.parse(e.atob(t.split(".")[1]));return r.exp>Date.now()};const m=function(){const t=n();if(!t){return}const r=JSON.parse(e.atob(t.split(".")[1]));return{userid:r.userid,email:r.email}};return{getToken:n,saveToken:r,register:o,login:a,changeProfile:i,changePassword:c,deleteAccount:l,logout:s,isLoggedIn:u,currentUser:m}}})();