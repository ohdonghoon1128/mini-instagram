(function(){angular.module("instagramApp",["ngRoute","ngSanitize","ui.bootstrap","ngFileUpload"]);function t(t){t.when("/",{templateUrl:"/app_client/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/setting/profile",{templateUrl:"/app_client/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/setting/account",{templateUrl:"/app_client/account/account.view.html",controller:"accountCtrl",controllerAs:"vm"}).when("/user/:userid",{templateUrl:"/app_client/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("instagramApp").config(["$routeProvider",t])})();(function(){angular.module("instagramApp").controller("homeCtrl",t);t.$inject=["$routeParams","$http","authentication","Upload","$scope","photoData"];function t(t,e,o,n,r,a){const i=3;const l=this;l.pageHeader={title:"mini-instagram"};l.data={};const c=t.userid;if(c){u(c)}else{s()}function s(){a.getPhotoUrlsByTime().then(t=>{console.log(t.data);l.data.urls=m(t.data,i)}).then(null,t=>{console.log(t);console.log(t.data.message)})}function u(t){a.getPhotoUrlsByUserId(t).then(t=>{l.data.urls=m(t.data,i)}).then(null,t=>{console.log(t);console.log(t.data.message)})}function m(t,e){const o=[];let n=-1;for(let r=0;r<t.length;r++){col=r%e;if(col===0){o[++n]=[]}o[n][col]=t[r]}return o}r.submit=function(){const t=r.file;console.log(t);n.upload({url:"/api/photo/",data:{photo:t,username:"hey"},headers:{Authorization:o.getToken()}}).then(t=>{console.log(t.data.message)}).then(null,t=>{console.log(t.data.message)})}}})();(function(){angular.module("instagramApp").controller("profileCtrl",t);t.$inject=["authentication"];function t(t){const e=this;e.pageHeader={title:"Profile"};e.formData={};e.onSubmit=function(){e.formError="";e.formSuccess="";if(!e.formData.name&&!e.formData.email){}else{}return false}}})();(function(){angular.module("instagramApp").controller("accountCtrl",t);t.$inject=["authentication","$location"];function t(t,e){const o=this;o.pageHeader={title:"Account"};o.formData={};o.onSubmit=function(){o.formError="";o.formSuccess="";if(!o.formData.password||!o.formData.newPassword||!o.formData.confirmNewPassword){o.formError="old password, new password and confirm new password are required"}else if(o.formData.newPassword!==o.formData.confirmNewPassword){o.formError="new password and confirm new password must be the same"}else{t.changePassword(o.formData).then(t=>{o.formSuccess="Password successfully changed"}).then(null,t=>{o.formError=t.data.message})}return false};o.deleteAccount=function(){t.deleteAccount().then(o=>{t.logout();e.path("/")}).then(null,t=>{o.formError=t.data.message})}}})();(function(){angular.module("instagramApp").controller("loginModalCtrl",t);t.$inject=["$uibModalInstance","authentication"];function t(t,e){const o=this;o.formData={};o.onSubmit=function(){o.formError="";if(!o.formData.userid||!o.formData.password){o.formError="userid and password are required!";return false}else{e.login(o.formData).then(e=>{t.close()}).then(null,t=>{o.formError=t.data.message});return false}};o.cancel=function(){t.dismiss("cancel")}}})();(function(){angular.module("instagramApp").controller("registerModalCtrl",t);t.$inject=["$uibModalInstance","authentication"];function t(t,e){const o=this;o.formData={};o.onSubmit=function(){o.formError="";if(!o.formData.userid||!o.formData.email||!o.formData.password){o.formError="userid, email and password are required!"}else if(o.formData.password!==o.confirmPassword){o.formError="Your password does not match each other."}else{e.register(o.formData).then(e=>{t.close()}).then(null,t=>{o.formError=t.data.message})}return false};o.cancel=function(){t.dismiss("cancel")}}})();(function(){angular.module("instagramApp").directive("pageHeader",t);function t(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/app_client/common/directives/pageHeader.template.html"}}})();(function(){angular.module("instagramApp").directive("navigation",t);function t(){return{restrict:"EA",templateUrl:"/app_client/common/directives/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("instagramApp").controller("navigationCtrl",t);t.$inject=["authentication","$location","$uibModal","$window"];function t(t,e,o,n){const r=this;r.isLoggedIn=t.isLoggedIn();r.currentPath=e.path();r.currentUser=t.currentUser();r.logout=function(){t.logout();n.location.assign("/");n.reload()};r.login=function(){const t=o.open({templateUrl:"/app_client/loginModal/loginModal.view.html",controller:"loginModalCtrl as vm"});t.result.then(t=>{console.log(r.currentPath);n.location.assign(r.currentPath);n.reload()})};r.register=function(){const t=o.open({templateUrl:"/app_client/registerModal/registerModal.view.html",controller:"registerModalCtrl as vm"});t.result.then(t=>{console.log(r.currentPath);n.location.assign(r.currentPath);n.reload()})}}})();(function(){angular.module("instagramApp").directive("footerGeneric",t);function t(){return{restrict:"EA",templateUrl:"/app_client/common/directives/footerGeneric.template.html"}}})();(function(){angular.module("instagramApp").directive("settingPanel",t);function t(){return{restrict:"EA",scope:{select:"=select"},templateUrl:"/app_client/common/directives/settingPanel.template.html"}}})();(function(){angular.module("instagramApp").directive("httpSrc",t);t.$inject=["$http","authentication"];function t(t,e){const o={link:n,restrict:"A"};return o;function n(o,n,r){var a={method:"Get",url:r.httpSrc,responseType:"arraybuffer",cache:"true",headers:{Authorization:e.getToken()}};console.log(a);t(a).then(function(t){var e=new Uint8Array(t.data);var o="";var n,a,i,l=5e3;for(n=0,a=e.length;n<a;n+=l){i=e.subarray(n,n+l);o+=String.fromCharCode.apply(null,i)}var c=btoa(o);r.$set("src","data:image/jpeg;base64,"+c)}).then(null,t=>{console.log(t)})}}})();(function(){angular.module("instagramApp").service("authentication",t);t.$inject=["$http","$window"];function t(t,e){const o=function(){return e.localStorage.userToken?"Bearer "+e.localStorage.userToken:""};const n=function(t){if(!t){throw new Error(`invalid token(${t})`)}e.localStorage.userToken=t};const r=function(e){return t.post(`/api/account/register`,e).then(t=>{n(t.data.token);return t})};const a=function(e){return t.post(`/api/account/login`,e).then(t=>{n(t.data.token);return t})};const i=function(t){};const l=function(e){return t.put(`/api/account/password`,e,{headers:{Authorization:o()}}).then(t=>{n(t.data.token);return t})};const c=function(){return t.delete(`/api/account/delete`,{headers:{Authorization:o()}})};const s=function(){e.localStorage.removeItem("userToken")};const u=function(){const t=e.localStorage.userToken;if(!t){return false}const o=JSON.parse(e.atob(t.split(".")[1]));return o.exp>Date.now()};const m=function(){const t=e.localStorage.userToken;if(!t){return}const o=JSON.parse(e.atob(t.split(".")[1]));return{userid:o.userid,email:o.email}};return{getToken:o,saveToken:n,register:r,login:a,changeProfile:i,changePassword:l,deleteAccount:c,logout:s,isLoggedIn:u,currentUser:m}}})();(function(){angular.module("instagramApp").service("photoData",t);t.$inject=["$http","authentication","Upload"];function t(t,e,o){const n=function(o){return t.delete(`/api/photo/${o}`,{headers:{Authorization:e.getToken()}})};const r=function(o){return t.get(`/api/photo?ownerid=${o}`,{headers:{Authorization:e.getToken()}})};const a=function(){return t.get(`/api/randomPhotos`)};return{deletePhoto:n,getPhotoUrlsByUserId:r,getPhotoUrlsByTime:a}}})();