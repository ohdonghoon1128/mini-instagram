(function(){angular.module("instagramApp",["ngRoute","ngSanitize","ui.bootstrap","ngFileUpload"]);function e(e){e.when("/",{templateUrl:"/app_client/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/setting/profile",{templateUrl:"/app_client/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/setting/account",{templateUrl:"/app_client/account/account.view.html",controller:"accountCtrl",controllerAs:"vm"}).when("/user/:userid",{templateUrl:"/app_client/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("instagramApp").config(["$routeProvider",e])})();(function(){angular.module("instagramApp").controller("homeCtrl",e);e.$inject=["$routeParams","authentication","photoData","$uibModal","$route"];function e(e,t,o,n,r){const a=this;const i=3;a.data={};const l=e.userid;if(l){s(l)}else{c()}function c(){o.getPhotoUrlsByTime().then(e=>{a.data.photoInfos=u(e.data,i);a.popupPhotoDetail=m}).then(null,e=>{console.log(e.data)})}function s(e){o.getPhotoUrlsByUserId(e).then(e=>{a.data.photoInfos=u(e.data,i);a.popupPhotoDetail=m}).then(null,e=>{console.log(e.data)})}function u(e,t){const o=[];let n=-1;for(let r=0;r<e.length;r++){col=r%t;if(col===0){o[++n]=[]}o[n][col]=e[r]}return o}function m(e){const t=n.open({templateUrl:"/app_client/photoDetailModal/photoDetailModal.view.html",controller:"photoDetailModalCtrl as vm",size:"lg",resolve:{photoInfo:function(){return e}}});t.result.then(e=>{r.reload()})}}})();(function(){angular.module("instagramApp").controller("profileCtrl",e);e.$inject=["authentication","userData"];function e(e,t){const o=this;o.currentPage={title:"Profile"};o.formData={};o.onSubmit=function(){o.formError="";o.formSuccess="";if(!o.formData.name&&!o.formData.description&&!o.formData.email){o.formError="You have not changed anything yet!"}else{t.updateUserInfo(o.formData).then(t=>{e.saveToken(t.data.token);o.formSuccess="profile successfully changed"}).then(null,e=>{o.formError=e.data.message})}return false}}})();(function(){angular.module("instagramApp").controller("accountCtrl",e);e.$inject=["authentication","$location"];function e(e,t){const o=this;o.currentPage={title:"Account"};o.formData={};o.currentUser=e.currentUser();o.onSubmit=function(){o.formError="";o.formSuccess="";if(!o.formData.password||!o.formData.newPassword||!o.formData.confirmNewPassword){o.formError="old password, new password and confirm new password are required"}else if(o.formData.newPassword!==o.formData.confirmNewPassword){o.formError="new password and confirm new password must be the same"}else{e.changePassword(o.formData).then(e=>{o.formSuccess="Password successfully changed"}).then(null,e=>{o.formError=e.data.message})}return false};e.getAccessLevel(o.currentUser.userid).then(e=>{o.getAccessLevel=e.data.isPrivate?"Private":"Public"}).then(null,e=>{o.formError=e.data.message});o.changeAccessLevel=function(){o.formError="";o.formSuccess="";if(!o.isPrivate){o.formError="Please choose either Public or Private"}else{e.changeAccessLevel(o.isPrivate).then(e=>{o.getAccessLevel=e.data.isPrivate?"Private":"Public";o.formSuccess="You access level changed successfully"}).then(null,e=>{o.formError=e.data.message})}};o.deleteAccount=function(){o.formSuccess="";o.formError="";if(!o.deletePassword){o.formError="Please provide your password to delete your account";return false}e.deleteAccount(o.deletePassword).then(o=>{e.logout();t.path("/")}).then(null,e=>{o.formError=e.data.message})}}})();(function(){angular.module("instagramApp").controller("loginModalCtrl",e);e.$inject=["$uibModalInstance","authentication","$location"];function e(e,t,o){const n=this;n.formData={};n.onSubmit=function(){n.formError="";if(!n.formData.userid||!n.formData.password){n.formError="userid and password are required!";return false}else{t.login(n.formData).then(t=>{e.close()}).then(null,e=>{n.formError=e.data.message});return false}};n.cancel=function(){e.dismiss("cancel")}}})();(function(){angular.module("instagramApp").controller("registerModalCtrl",e);e.$inject=["$uibModalInstance","authentication"];function e(e,t){const o=this;o.formData={};o.onSubmit=function(){o.formError="";if(!o.formData.userid||!o.formData.email||!o.formData.password){o.formError="userid, email and password are required!"}else if(o.formData.password!==o.confirmPassword){o.formError="Your password does not match each other."}else if(o.formData.userid.search(/^[A-Za-z][A-Za-z0-9_]*$/)<0){o.formError="Your id start with alphabet character followed by alphabet or _ character"}else{t.register(o.formData).then(t=>{e.close()}).then(null,e=>{o.formError=e.data.message})}return false};o.cancel=function(){e.dismiss("cancel")}}})();(function(){angular.module("instagramApp").controller("uploadPhotoModalCtrl",e);e.$inject=["$scope","authentication","Upload","$uibModalInstance"];function e(e,t,o,n){const r=this;console.log("photo modal are your executing?");r.submit=function(){if(e.form.file.$valid&&e.file){a(e.file)}};function a(e){r.formError="";o.upload({url:"/api/photo/",data:{photo:e},headers:{Authorization:t.getToken()}}).then(e=>{n.close(e.data.photoUrl)}).then(null,e=>{r.formError="Uploading Failed, Please try later.";console.log(e.data.message)})}r.modal={cancel:function(){n.dismiss("cancel")}}}})();(function(){angular.module("instagramApp").controller("photoDetailModalCtrl",e);e.$inject=["$uibModalInstance","photoData","photoInfo","authentication"];function e(e,t,o,n){const r=this;r.receivedData={};r.sendingData={};r.photoInfo=o;r.photoInfo.name="delete";r.isMyPhoto=n.currentUser().userid===o.ownerid;if(n.isLoggedIn()){r.addComment=function(){r.formSuccess="";r.formError="";if(!r.sendingData.comment){return}else if(typeof r.sendingData.comment==="string"){r.sendingData.comment=r.sendingData.comment.trim().replace(/\s+/g," ")}t.addCommentById(r.photoInfo.photoid,r.sendingData.comment).then(e=>{if(Array.isArray(r.receivedData.comments)){r.receivedData.comments.push(e.data.comment)}}).then(null,e=>{r.formError=e.data.message})}}t.getCommentsById(r.photoInfo.photoid).then(e=>{r.receivedData.comments=e.data}).then(null,e=>{r.formError=e.data.message});r.onDelete=function(){r.formSuccess="";r.formError="";if(r.confirmPhotoName!==r.photoInfo.name){r.formError=`Please type ${r.photoInfo.name} to confirm`}else{t.deletePhotoById(r.photoInfo.photoid).then(t=>{e.close()}).then(null,e=>{r.formError=e.data.message})}};r.modal={cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("instagramApp").directive("pageHeader",e);function e(){return{restrict:"EA",templateUrl:"/app_client/common/directives/pageHeader.template.html",controller:"pageHeaderCtrl as phvm"}}})();(function(){angular.module("instagramApp").controller("pageHeaderCtrl",e);e.$inject=["$routeParams","authentication","userData","$uibModal","$route"];function e(e,t,o,n,r){const a=this;a.currentUser=t.currentUser();a.isLoggedIn=t.isLoggedIn();a.userid=e.userid;if(a.isLoggedIn){a.popupUpload=i}if(a.userid){l(a.userid)}function i(){const e=n.open({templateUrl:"/app_client/uploadPhotoModal/uploadPhotoModal.view.html",controller:"uploadPhotoModalCtrl as vm"});e.result.then(e=>{r.reload()})}function l(e){o.getUserInfoById(e).then(e=>{a.data=e.data;console.log(e.data)}).then(null,e=>{console.log(e.data)})}}})();(function(){angular.module("instagramApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/app_client/common/directives/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("instagramApp").controller("navigationCtrl",e);e.$inject=["authentication","$location","$uibModal","$window","$route"];function e(e,t,o,n,r){const a=this;a.isLoggedIn=e.isLoggedIn();a.currentPath=t.path();a.currentUser=e.currentUser();a.logout=function(){e.logout();n.location.assign("/");n.reload()};a.login=function(){const e=o.open({templateUrl:"/app_client/loginModal/loginModal.view.html",controller:"loginModalCtrl as vm"});e.result.then(e=>{r.reload()})};a.register=function(){const e=o.open({templateUrl:"/app_client/registerModal/registerModal.view.html",controller:"registerModalCtrl as vm"});e.result.then(e=>{r.reload()})}}})();(function(){angular.module("instagramApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/app_client/common/directives/footerGeneric.template.html"}}})();(function(){angular.module("instagramApp").directive("settingPanel",e);function e(){return{restrict:"EA",scope:{select:"=select"},templateUrl:"/app_client/common/directives/settingPanel.template.html"}}})();(function(){angular.module("instagramApp").directive("httpSrc",e);e.$inject=["$http","authentication"];function e(e,t){const o={link:n,restrict:"A"};return o;function n(o,n,r){var a={method:"Get",url:r.httpSrc,responseType:"arraybuffer",cache:"true",headers:{Authorization:t.getToken()}};console.log(a);e(a).then(function(e){var t=new Uint8Array(e.data);var o="";var n,a,i,l=5e3;for(n=0,a=t.length;n<a;n+=l){i=t.subarray(n,n+l);o+=String.fromCharCode.apply(null,i)}var c=btoa(o);r.$set("src","data:image/jpeg;base64,"+c)}).then(null,e=>{console.log(e)})}}})();(function(){angular.module("instagramApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){const o=function(){return t.localStorage.userToken?"Bearer "+t.localStorage.userToken:""};const n=function(e){if(!e){throw new Error(`invalid token(${e})`)}t.localStorage.userToken=e};const r=function(t){return e.post(`/api/account/register`,t).then(e=>{n(e.data.token);return e})};const a=function(t){return e.post(`/api/account/login`,t).then(e=>{n(e.data.token);return e})};const i=function(e){};const l=function(t){return e.put(`/api/account/password`,t,{headers:{Authorization:o()}}).then(e=>{n(e.data.token);return e})};const c=function(t){return e.post(`/api/account/delete`,{password:t},{headers:{Authorization:o()}})};const s=function(){t.localStorage.removeItem("userToken")};const u=function(){const e=t.localStorage.userToken;if(!e){return false}const o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()};const m=function(){const e=t.localStorage.userToken;if(!e){return{}}const o=JSON.parse(t.atob(e.split(".")[1]));return{userid:o.userid,email:o.email}};const d=function(t){return e.get(`/api/account/user/${t}/access_level`)};const f=function(t){return e.put(`/api/account/access_level`,{isPrivate:t},{headers:{Authorization:o()}})};return{getToken:o,saveToken:n,register:r,login:a,changeProfile:i,changePassword:l,deleteAccount:c,logout:s,isLoggedIn:u,currentUser:m,getAccessLevel:d,changeAccessLevel:f}}})();(function(){angular.module("instagramApp").service("photoData",e);e.$inject=["$http","authentication","Upload"];function e(e,t,o){const n=function(o){return e.delete(`/api/photo/${o}`,{headers:{Authorization:t.getToken()}})};const r=function(o){return e.get(`/api/photo?ownerid=${o}`,{headers:{Authorization:t.getToken()}})};const a=function(){return e.get(`/api/randomPhotos`)};const i=function(o){return e.get(`/api/photo/${o}/comment`,{headers:{Authorization:t.getToken()}})};const l=function(o,n){return e.post(`/api/photo/${o}/comment`,{comment:n},{headers:{Authorization:t.getToken()}})};return{deletePhotoById:n,getPhotoUrlsByUserId:r,getPhotoUrlsByTime:a,getCommentsById:i,addCommentById:l}}})();(function(){angular.module("instagramApp").service("userData",e);e.$inject=["$http","authentication"];function e(e,t){const o=function(t){return e.get(`/api/account/user/${t}`)};const n=function(o){return e.put(`/api/account/profile`,o,{headers:{Authorization:t.getToken()}})};return{getUserInfoById:o,updateUserInfo:n}}})();